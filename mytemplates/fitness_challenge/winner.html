<link type="text/css" href="{{ STATIC_URL }}jquery-ui-1.8.17.custom/css/custom-theme/jquery-ui-1.8.17.custom.css" rel="Stylesheet" />
<script type="text/javascript" src="{{ STATIC_URL }}jquery-ui-1.8.17.custom/js/jquery-1.7.1.min.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}jquery-ui-1.8.17.custom/js/jquery-ui-1.8.17.custom.min.js"></script>
<script type="text/javascript">
    var colors = ["#B8D4S0", "#3AB745", "#029990", "#3501CB",
                  "#2E2C75", "#673A7E", "#CC0071", "#F80120",
                  "#F35B20", "#FB9A00", "#FFCC00", "#FEF200"];

    var restaraunts = ["Wendy's", "McDonalds", "Chick-fil-a", "Five Guys",
                       "Gold Star", "La Mexicana", "Chipotle", "Tazza Mia",
                       "Panera", "Just Crepes", "Arby's", "Indian"];

    var startAngle = 0;
    var halfEntrySize = {{ entries_size }} / 2;
    var spinTimeout = null;

    var spinArcStart = 10;
    var spinTime = 0;

    var ctx;

    function drawRouletteWheel() {
        var canvas = document.getElementById("canvas");
        if(canvas.getContext) {
            var outsideRadius = 200;
            var textRadius = 160;
            var insideRadius = 125;

            ctx = canvas.getContext("2d");
            ctx.clearRect(0, 0, 500, 500);

            ctx.strokeStyle = "black";
            ctx.lineWidth = 2;

            ctx.font = 'bold 12px Helvetica, Arial';
            {% for entry in entries %}
                var angle = startAngle + {{ forloop.counter0}} * {{ arc }};
                ctx.fillStyle = colors[Math.ceil(Math.random() * 12)];

                ctx.beginPath();
                ctx.arc(250, 250, outsideRadius, angle, angle + {{ arc }}, false);
                ctx.arc(250, 250, insideRadius, angle + {{ arc }}, angle, true);
                ctx.stroke();
                ctx.fill();

                ctx.save();
                ctx.shadowOffsetX = -1;
                ctx.shadowOffsetY = -1;
                ctx.shadowBlur    = 0;
                ctx.shadowColor   = "rgb(220,220,220)";
                ctx.fillStyle = "black";
                ctx.translate(250 + Math.cos(angle + {{ arc }} / 2) * textRadius,
                              250 + Math.sin(angle + {{ arc }} / 2) * textRadius);
                ctx.rotate(angle + {{ arc }} / 2 + Math.PI / 2);
                var text = '{{ entry.name }}';
                ctx.fillText(text, ctx.measureText(text).width / 2, 0);
                ctx.restore();
            {% endfor %}


            //Arrow
            ctx.fillStyle = "black";
            ctx.beginPath();
            ctx.moveTo(250 - 4, 250 - (outsideRadius + 5));
            ctx.lineTo(250 + 4, 250 - (outsideRadius + 5));
            ctx.lineTo(250 + 4, 250 - (outsideRadius - 5));
            ctx.lineTo(250 + 9, 250 - (outsideRadius - 5));
            ctx.lineTo(250 + 0, 250 - (outsideRadius - 13));
            ctx.lineTo(250 - 9, 250 - (outsideRadius - 5));
            ctx.lineTo(250 - 4, 250 - (outsideRadius - 5));
            ctx.lineTo(250 - 4, 250 - (outsideRadius + 5));
            ctx.fill();
        }
    }

    function spin() {
        spinTime = 0;
        rotateWheel();
    }

    function rotateWheel() {
        spinTime += 30;
        if (spinTime >= {{ spin_time_total }}) {
            stopRotateWheel();
            return;
        }
        var spinAngle = {{ spin_angle_start }} - easeOut(spinTime, 0, {{ spin_angle_start }}, {{ spin_time_total }});
        startAngle += (spinAngle * Math.PI / 180);
        drawRouletteWheel();
        spinTimeout = setTimeout('rotateWheel()', 30);
    }

    function stopRotateWheel() {
        clearTimeout(spinTimeout);
        ctx.save();
        ctx.font = 'bold 30px Helvetica, Arial';
        var text = '{{ winner.name }}'
        ctx.fillText(text, 250 - ctx.measureText(text).width / 2, 250 + 10);
        ctx.restore();
    }

    function easeOut(t, b, c, d) {
      var ts = (t/=d)*t;
      var tc = ts*t;
      return b+c*(tc + -3*ts + 3*t);
    }

    $(document).ready(function(){
        drawRouletteWheel();
    });

</script>

<h1>And the winner is....</h1>

<h3>{{ winner.name }} from their workout on {{ winner.date }}!</h3>

<br/>

<a href="/fitness_challenge">Home</a>

<input type="button" value="spin" onclick="spin();" style="float:left;" />
<canvas id="canvas" width="500" height="500"></canvas>